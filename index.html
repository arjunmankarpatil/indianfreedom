<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Freedom Runner — Indian Independence</title>

<!-- PWA Meta -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#FF9933">
<link rel="icon" sizes="192x192" href="icons/icon-192.png">
<link rel="apple-touch-icon" href="icons/icon-512.png">

<style>
    html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden;
        background: #03101c;
        color: white;
        font-family: Arial, sans-serif;
    }
    canvas {
        display: block;
        background: linear-gradient(#FF9933, white, #138808);
        touch-action: none;
    }
    footer {
        position: fixed;
        bottom: 0;
        width: 100%;
        padding: 8px;
        background: rgba(0, 0, 0, 0.7);
        font-size: 14px;
        text-align: center;
    }
    footer a {
        color: #00aced;
        text-decoration: none;
    }
</style>
</head>
<body>

<canvas id="gameCanvas"></canvas>

<footer>
    A game by Arjun Mankar — 
    <a href="https://www.instagram.com/arjunmankar79/" target="_blank">@arjunmankar79</a>
</footer>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let player, obstacles, score, gameOver;
let gravity = 0.5;
let jumpPower = -10;
let obstacleSpeed = 5;
let obstacleFrequency = 100;

// Resize for mobile
function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight - document.querySelector('footer').offsetHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

function initGame() {
    player = {
        x: canvas.width * 0.1,
        y: canvas.height * 0.8,
        width: canvas.width * 0.08,
        height: canvas.height * 0.08,
        dy: 0
    };
    obstacles = [];
    score = 0;
    gameOver = false;
}

function drawPlayer() {
    ctx.fillStyle = '#FFD700';
    ctx.fillRect(player.x, player.y, player.width, player.height);
}

function drawObstacles() {
    ctx.fillStyle = '#8B0000';
    obstacles.forEach(obs => {
        ctx.fillRect(obs.x, obs.y, obs.width, obs.height);
    });
}

function drawScore() {
    ctx.fillStyle = 'black';
    ctx.font = `${Math.floor(canvas.height * 0.05)}px Arial`;
    ctx.fillText(`Score: ${score}`, 20, 40);
}

function updatePlayer() {
    player.y += player.dy;
    player.dy += gravity;
    if (player.y + player.height > canvas.height) {
        player.y = canvas.height - player.height;
        player.dy = 0;
    }
}

function spawnObstacle() {
    let height = canvas.height * 0.08;
    let y = canvas.height - height;
    obstacles.push({
        x: canvas.width,
        y: y,
        width: canvas.width * 0.05,
        height: height
    });
}

function updateObstacles() {
    obstacles.forEach(obs => { obs.x -= obstacleSpeed; });
    obstacles = obstacles.filter(obs => obs.x + obs.width > 0);
}

function checkCollision() {
    obstacles.forEach(obs => {
        if (player.x < obs.x + obs.width &&
            player.x + player.width > obs.x &&
            player.y < obs.y + obs.height &&
            player.y + player.height > obs.y) {
            gameOver = true;
        }
    });
}

function gameLoop() {
    if (gameOver) {
        ctx.fillStyle = 'black';
        ctx.font = `${Math.floor(canvas.height * 0.06)}px Arial`;
        ctx.fillText("Game Over! Tap to Restart", canvas.width/4, canvas.height/2);
        return;
    }

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawPlayer();
    drawObstacles();
    drawScore();

    updatePlayer();
    updateObstacles();
    checkCollision();

    score++;
    if (score % obstacleFrequency === 0) spawnObstacle();

    requestAnimationFrame(gameLoop);
}

// Tap or space to jump / restart
function jump() {
    if (gameOver) {
        initGame();
        gameLoop();
    } else if (player.y >= canvas.height - player.height) {
        player.dy = jumpPower;
    }
}
canvas.addEventListener('touchstart', jump);
document.addEventListener('keydown', (e) => { if (e.code === 'Space') jump(); });

initGame();
gameLoop();

// ===== PWA Service Worker Registration =====
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js')
        .then(reg => console.log('Service Worker Registered:', reg.scope))
        .catch(err => console.log('Service Worker Registration Failed:', err));
    });
}
</script>

</body>
</html>
